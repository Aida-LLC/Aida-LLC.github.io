<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Bio Preview</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Londrina+Outline&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=DynaPuff:wght@400..700&family=Londrina+Outline&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            height: 100vh;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f5f5f7;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            width: 90%;
            max-width: 1200px;
            height: 80vh;
            display: flex;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .left-panel {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 2rem;
            background: #f0f0f0;
            border-right: 1px solid rgba(0, 0, 0, 0.1);
            background-size: cover;
            background-position: center;
        }

        .right-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 3rem;
            background: white;
            position: relative;
        }

        .app-name {
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-family: 'DynaPuff', system-ui;
            font-optical-sizing: auto;
            font-weight: 400;
            font-style: normal;
            font-variation-settings: "wdth" 100;
            font-size: 1.5rem;
            color: #ff6b6b;
            transform: rotate(-5deg);
        }

        .name {
            font-size: 2.5rem;
            font-weight: 700;
            color: #1a1a1a;
            margin-bottom: 1rem;
            margin-top: auto;
            opacity: 0;
            animation: fadeInUp 0.8s ease forwards;
        }

        .bio {
            font-size: 1.2rem;
            line-height: 1.6;
            color: #666;
            margin-bottom: auto;
            opacity: 0;
            animation: fadeInUp 0.8s ease 0.2s forwards;
        }

        .countdown {
            color: #ff6b6b;
            font-weight: bold;
            display: none;
            margin-top: 1rem;
        }

        .social-links {
            display: flex;
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .social-link {
            text-decoration: none;
            color: #333;
            transition: transform 0.3s ease;
        }

        .social-link:hover {
            transform: scale(1.1);
        }

        .social-link svg {
            width: 24px;
            height: 24px;
            fill: currentColor;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .placeholder-image {
            width: 100%;
            height: 100%;
            background: linear-gradient(145deg, #e6e6e6, #f0f0f0);
            border-radius: 3%;
            position: relative;
            overflow: hidden;
        }

        .placeholder-image::after {
            content: 'üê¶‚Äçüî•';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3rem;
            color: #999;
        }

        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }

            .left-panel {
                width: 100%;
                height: 30%;
                max-height: 250px;
                border-right: none;
                border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            }

            .right-panel {
                width: 100%;
                height: 50%;
                padding: 2rem;
            }

            .name {
                font-size: 2rem;
            }

            .bio {
                font-size: 1rem;
            }

            .app-name {
                font-size: 1.2rem;
            }

            .countdown {
                font-size: 1rem;
            }

            .social-link svg {
                width: 20px;
                height: 20px;
            }
        }

        @media (max-width: 320px) {
            .left-panel {
                height: 30%;
                max-height: 250px;
            }

            .name {
                font-size: 1.5rem;
            }

            .bio {
                font-size: 0.9rem;
            }

            .app-name {
                font-size: 1rem;
            }

            .countdown {
                font-size: 0.9rem;
            }

            .social-link svg {
                width: 18px;
                height: 18px;
            }
        }
    </style>
</head>

<body>

    <div class="container">
        <div class="left-panel">
            <div class="placeholder-image"></div>
        </div>
        <div class="right-panel">
            <div class="app-name">WhoDis?</div>
            <h1 class="name"></h1>
            <p class="bio"></p>
            <p class="countdown"></p>
            <div class="social-links">
                <a href="tel:+" id="phoneLink" class="social-link" title="Phone Call">
                    <svg viewBox="0 0 24 24">
                        <path
                            d="M20.01 15.38c-1.23 0-2.42-.2-3.53-.56a.977.977 0 00-1.01.24l-1.57 1.97c-2.83-1.35-5.48-3.9-6.89-6.83l1.95-1.66c.27-.28.35-.67.24-1.02-.37-1.11-.56-2.3-.56-3.53 0-.54-.45-.99-.99-.99H4.19C3.65 3 3 3.24 3 3.99 3 13.28 10.73 21 20.01 21c.71 0 .99-.63.99-1.18v-3.45c0-.54-.45-.99-.99-.99z" />
                    </svg>
                </a>
                <a href="https://instagram.com/" class="social-link" title="Instagram">
                    <svg viewBox="0 0 24 24">
                        <path
                            d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z" />
                    </svg>
                </a>
            </div>
        </div>
    </div>

    <script>
        async function generateBioWithGemini(username, gender, intro, mobile, instagram) {
            try {
                const response = await fetch('https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=AIzaSyDRk-c2xFANZMREvyJkAUTJoqzgX2-64qU', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: `Generate a catchy, funny bio with Gen Z slang for ${username}, a ${gender}. ${intro}. Tell people this is their chance to get the contact or phone number info and warn them that you're going to call yourself from their phone in 15 seconds. this is all because we meet but no one care to share their contact details. Make it memorable and include a pun. Keep it under 200 characters.`
                            }]
                        }]
                    })
                });

                const data = await response.json();
                const candidates = data.candidates;

                if (candidates && candidates[0] && candidates[0].content) {
                    return candidates[0].content.parts[0].text;
                } else {
                    // Fallback to API if Gemini fails
                    return generateBioWithAPI(username, gender, intro, mobile, instagram);
                }
            } catch (error) {
                console.error('Error with Gemini:', error);
                return generateBioWithAPI(username, gender, intro, mobile, instagram);
            }
        }

        async function generateBioWithAPI(username, gender, intro, mobile, instagram) {
            try {
                const response = await fetch('/api/ai_completion', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                    },
                    body: JSON.stringify({
                        prompt: `Generate a catchy, funny bio with Gen Z slang for ${username}, and gender ${gender}. Tell people this is their chance to get the contact or phone number info and warn them that you're going to call yourself from their phone in 15 seconds. To make it even more personal use this my intro: '${intro}' you can make a joke from it, if gender is female make the joke witty. Keep it under 200 characters.`,
                        data: username
                    }),
                });
                const data = await response.json();
                return data.bio;
            } catch (error) {
                console.error('Error generating bio:', error);
                return "Hey! Drop me a line and let's connect! üì±‚ú® Quick, you have 15 seconds before I call myself!";
            }
        }

        function startCountdown(seconds) {
            const countdownElement = document.querySelector('.countdown');

            const interval = setInterval(() => {

                countdownElement.textContent = `Calling in ${seconds} seconds...`;
                seconds--;
                if (seconds < 4) {
                    countdownElement.style.display = 'block';
                }
                if(seconds === 0) {
                    countdownElement.textContent = `Here: ${user.mobile}`;
                }
                if (seconds < 1) {
                    clearInterval(interval);
                    const phoneLink = document.getElementById('phoneLink');
                    phoneLink.click();
                }
            }, 1000);
        }

        window.onload = async function () {
            try {
                user = {
                    username: 'Sikjunior Mrimi',
                    gender: 'male',
                    intro: 'Graphics designer, Developer, Singer, Under 5.6feet tall.',
                    mobile: '0672204508',
                    instagram: '@meetsik_',
                    avatar_url: 'https://pbs.twimg.com/media/Gduney-X0AAXSXp?format=jpg&name=large'
                }

                if (user) {
                    // Update name
                    document.querySelector('.name').textContent = '@' + user.username;

                    // Generate and update bio using Gemini
                    const generatedBio = await generateBioWithGemini(user.username, user.gender, user.intro, user.mobile, user.instagram);
                    document.querySelector('.bio').textContent = generatedBio;

                    // Update profile image as background
                    if (user.avatar_url) {
                        const leftPanel = document.querySelector('.left-panel');
                        leftPanel.style.backgroundImage = `url("${user.avatar_url}")`;
                        leftPanel.innerHTML = '';
                    }

                    // Update phone link
                    document.getElementById('phoneLink').href = `tel:${user.mobile}`;

                    // Update Instagram link
                    document.querySelector('.social-link[title="Instagram"]').href = `https://instagram.com/${user.instagram}`;

                    // Start countdown
                    startCountdown(25);
                }
            } catch (error) {
                console.error('Error fetching user data:', error);
            }
        };
    </script>

</body>

</html>